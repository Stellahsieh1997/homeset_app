<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; 
            style-src 'self' 'unsafe-inline'; 
            media-src *; 
            script-src 'self' 'unsafe-inline';
            img-src 'self' data: content:;">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <title>Furnitures</title>
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <link rel=stylesheet type="text/css" href="../www/css/F01.css">
    <link rel="stylesheet" href="../www/css/reset.css"> <!-- CSS reset -->
    <link rel="stylesheet" href="../www/css/style.css"> <!-- Resource style -->
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/long-press-event.min.js"></script>
    <script src="js/modernizr.js"></script> <!-- Modernizr -->
    <script src="js/main.js"></script><!-- Modernizr -->
    <script src="cordova.js" type="text/javascript"></script>


</head>

<!-- 最上面標題列 -->

<body class="font container-fluid" style="background-color: #f0f0f0;padding: 0px;">
    <div class="fixed-top" style="margin: 0px; padding:0px 10px ;background-color:#254F6E;">
        <div class="row  " style="background-color:#254F6E;">
            <div class="col-4" style="display: flex;align-content:center;left: 15px;">
                <a href="H01-1.html">
                    <i class="icon ion-ios-arrow-back icon1"></i>
                </a>
            </div>
            <div class="col-4 title">
                <p style="margin:0px;font-size:24px">客廳</p>
            </div>
            <div class="col-4 ">

            </div>
        </div>

        <!--櫃子-->
        <div class="row" style="background-color:#254F6E;">
            <div class="flex">
                <div>
                    <div class="circlefix">
                        <button type="button" class="buttontype" data-toggle="modal" data-target="#exampleModal"
                            style="outline: none;">
                            <i class="icon ion-md-add" style="font-size: 40px;color:rgb(255, 255, 255)"></i>
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <!-- 增加儲物櫃互動視窗 -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-radius: 5%;">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">新增儲物櫃</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body">
                    <form id="fform">
                        <div style="margin-bottom:10px;">
                            <label for="furniturename">儲物櫃名稱 </label>
                            <P id="fnwarn" style="display:inline-flex;color: red;"></P>
                            <input type="text" class="form-control" id="insertfname" required>
                        </div>
                        <div style="margin-bottom:10px;">
                            <label>照片</label><br>
                            <div id="fimg">
                                <P id="fpwarn" style="display:inline-flex;color: red;"></P>
                                <img src="" class="a" id="insertfphoto">
                            </div>

                            <div class="takephotobtn">
                                <a href="javascript:;" onclick="takephoto()">相機</a>
                            </div>
                            <div style="display: inline-flex; margin-right:10px"></div>
                            <div class="takephotobtn">
                                <a href="javascript:;" onclick="imgget()">從相簿中選擇</a>
                            </div>
                            <br>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="insertfurniture()">送出
                        </button>

                    </form>
                </div>
            </div>
        </div>
    </div>


    <!-- 放物品的地方 -->
    <div class="box-wrap">
        <div class="objcenter" style="height: 50vh;width: 100vw;">
            <!-- <p style="color:gray; font-size:18px;">請點選左上方的加鍵，以建立儲物櫃。</p> -->
        </div>
    </div>

    <!-- <nav class="cd-stretchy-nav">
        <a class="cd-nav-trigger" href="#0">

            <span aria-hidden="true"></span>
        </a>

        <ul>
            <li><a href="#0"><span>新增物品 <i class="icon ion-md-add"
                            style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 20px"></i></span></a></li>
            <li><a href="#0"><span>修改儲物櫃名稱<i class="icon ion-md-create"
                            style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 20px"></i></span></a></li>
            <li><a href="#0"><span>修改儲物櫃圖片<i class="icon ion-ios-create"
                            style="font-size:35px;color:rgb(255, 255, 255);padding:0 14px 0 19px"></i></span></a></li>
            <li><a href="#0"><span>刪除儲物櫃<i class="icon ion-ios-trash"
                            style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 25px"></i></span></a></li>
            <li><a href="#0"><span>共享儲物櫃<i class="icon ion-ios-share"
                            style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 25px"></i></span></a></li>
        </ul>

        <span aria-hidden="true" class="stretchy-nav-bg"></span>
    </nav> -->

    <!-- 新增物品 -->
    <div class="addthings">

    </div>

    <script>


        //資料庫
        document.addEventListener("deviceready", onDeviceReady, false);
        var db;
        function onDeviceReady() {
            db = window.sqlitePlugin.openDatabase({
                name: 'my.db',
                location: 'default',
            });
            //----------------------------------------------------------------------------------------------------
            //儲物櫃
            // db.sqlBatch([
            //     'CREATE TABLE IF NOT EXISTS furniture (furnitureId integer primary key, name text, image text, spaceId integer, email text)',
            //     ['INSERT INTO furniture (name, image) VALUES (?,?)', ['矮櫃', 'static/1.jpg']],
            //     ['INSERT INTO furniture (name, image) VALUES (?,?)', ['三層櫃', 'static/2.jpg']],
            // ], function () {
            //     // alert("sqlbatch");
            // }, function (error) {
            //     alert(error);
            // });

            db.transaction(function (tx) {
                tx.executeSql('CREATE TABLE IF NOT EXISTS furniture (furnitureId text primary key, name text, image text, spaceId text, email text)');
                tx.executeSql('CREATE TABLE IF NOT EXISTS thing (thingId text primary key, name text, description text, image text, category text, owner text, furnitureId text, number integer, layer integer, out integer, remind integer, time date, content text)');
            });

            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM furniture', [], function (tx, res) {
                    var len = res.rows.length;
                    // alert(len);
                    if (res.rows.length >= 1) {
                        for (var i = 0; i < len; i++) {
                            $(".flex").append(`<div id='fpress` + res.rows.item(i)['furnitureId'] + `' onclick='fidclick("` + res.rows.item(i)['furnitureId'] + `")'><img src='` + res.rows.item(i)['image'] + `' height='90' width='90' class='square' id='` + res.rows.item(i)['furnitureId'] + `' onclick='fclick("` + res.rows.item(i)['furnitureId'] + `")'><div class='content' id='fname` + res.rows.item(i)['furnitureId'] + `'>` + res.rows.item(i)['name'] + `</div></div>`)

                            var fed = `<div class="modal" id="fed` + res.rows.item(i)['furnitureId'] + `" tabindex="-1" role="dialog" aria-labelledby="fed` + res.rows.item(i)['furnitureId'] + `" aria-hidden="true">
                                <div class="modal-dialog modal-xl" role="document" style="margin: 0px;position: absolute;bottom:0px; max-width: 1500px;width:100vw">
                                <div class="modal-content" style="border-radius: 0%;">
                                <div class="modal-body " style="background-color: #254F6E">
                                <div class="row" style="width:100vw;text-align: center">
                                <div class="col-4" onclick="fnclick('` + res.rows.item(i)['furnitureId'] + `','` + res.rows.item(i)['name'] + `')">
                                <i class="icon ion-md-create" style="font-size:35px;color:rgb(255, 255, 255);padding: 0px"></i>
                                <p style="color: #f0f0f0">編輯名稱</p>
                                </div>
                                <div class="col-4" onclick="fdclick('`+ res.rows.item(i)['furnitureId'] + `')">
                                <i class="icon ion-ios-trash" style="font-size:35px;color:rgb(255, 255, 255);padding: 0px"></i> 
                                <p style="color: #f0f0f0">刪除</p> 
                                </div> 
                                <div class="col-4" onclick="fsclick( '`+ res.rows.item(i)['furnitureId'] + `' )"> 
                                <i class="icon ion-ios-share" style="font-size:35px;color:rgb(255, 255, 255);padding: 0px"></i> 
                                <p style="color: #f0f0f0">共享</p> 
                                </div> 
                                </div> 
                                <div class="row" style="width:100vw;text-align: center"> 
                                <div class="col-4" onclick="fpclick('` + res.rows.item(i)['furnitureId'] + `','` + res.rows.item(i)['image'] + `','` + res.rows.item(i)['name'] + `')"> 
                                <i class="icon ion-ios-create" style="font-size:35px;color:rgb(255, 255, 255);padding: 0px"></i> 
                                <p style="color: #f0f0f0">編輯圖片</p> 
                                </div> 
                                <div class="col-4"></div> 
                                <div class="col-4 fedtitle"> 
                                <p style="color: #f0f0f0;" id="fpoint`+ res.rows.item(i)['furnitureId'] + `"> ` + res.rows.item(i)['name'] + `</p>
                                </div> 
                                </div> 
                                </div> 
                                </div> 
                                </div> 
                                </div>`;

                            $("body").append(fed);
                            var feds = `<script>
                            document.getElementById("fpress`+ res.rows.item(i)['furnitureId'] + `").addEventListener('long-press', function (e) {
                                $("#fed`+ res.rows.item(i)['furnitureId'] + `").modal('show');
                            });<\/script>`;

                            $("body").append(feds);

                            fped = `<div class="modal fade " id="fped` + res.rows.item(i)['furnitureId'] + `" tabindex="-1" role="dialog" aria-labelledby="fped` + res.rows.item(i)['furnitureId'] + `" aria-hidden="False">
                                        <div class="modal-dialog modal-dialog-centered" role="document">
                                             <div class="modal-content" style="border-radius: 5%;">
                                                <div class="modal-header">
                                                    <h5 class="modal-title"><b id="fpname`+ res.rows.item(i)['furnitureId'] + `">` + res.rows.item(i)['name'] + `</b></h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                    </button>
                                                </div>
                                            <div class="modal-body text-black">
                                                <div id="feimg`+ res.rows.item(i)['furnitureId'] + `" style="text-align:center">
                                                <img src="` + res.rows.item(i)['image'] + `" class="fephotothumb" id="fimagedit` + res.rows.item(i)['furnitureId'] + `">
                                                </div>
                                                <div class="row" style="text-align: center">
                                                    <div class="col">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="fimgedit('`+ res.rows.item(i)['furnitureId'] + `')">換圖</button>
                                                    </div>
                                                    <div class="col">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="fpdv('`+ res.rows.item(i)['furnitureId'] + `')">儲存</button>
                                                    </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>`
                            $("body").append(fped);

                            fdd = `<div class="modal fade" id="fdd` + res.rows.item(i)['furnitureId'] + `" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel5" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content" style="margin-top: 50%;border-radius: 5%;">
                                            <div class="modal-body text-black">
                                                <p>是否要刪除<spen id="fdname`+ res.rows.item(i)['furnitureId'] + `">` + res.rows.item(i)['name'] + `</spen>?</p>
                                                <div class="row" style="text-align: center">
                                                    <div class="col">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="fddc('`+ res.rows.item(i)['furnitureId'] + `')">取消</button>
                                                    </div>
                                                    <div class="col">
                                                        <button type="submit" class="btn btn-outline-secondary" onclick="fddv('`+ res.rows.item(i)['furnitureId'] + `')">確認</button>
                                                    </div>
                                                </div>
                                            </div>
                                       </div>
                                     </div>
                                    </div>`

                            $("body").append(fdd);

                            fsd = `<div class="modal fade" id="fsd` + res.rows.item(i)['furnitureId'] + `" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel6"
                                aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content" style="margin-top: 50%;border-radius: 5%;">
                                        <div class="modal-body text-black">
                                            <label>與他人共享<spen id="fsname`+ res.rows.item(i)['furnitureId'] + `">` + res.rows.item(i)['name'] + `</spen></label>
                                            <input type="text" class="form-control" placeholder="輸入使用者帳號(電子郵件地址)">

                                                <div class="row" style="text-align: center;margin-top: 5px">
                                                    <div class="col">
                                                        <button type="button" class="btn btn-outline-secondary" onclick="fsdc('`+ res.rows.item(i)['furnitureId'] + `')">取消</button>
                                                    </div>
                                                    <div class="col">
                                                        <button type="submit" class="btn btn-outline-secondary"
                                                            onclick="processFormData()">確認</button>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>`
                            $("body").append(fsd);
                        }



                        let urlParams = new URLSearchParams(window.location.search);
                        var furnitureId = urlParams.get('furniture');
                        if (!furnitureId) {
                            fidclick(res.rows.item(0)['furnitureId'])
                            fclick(res.rows.item(0)['furnitureId'])
                        } else {
                            fidclick(furnitureId)
                            fclick(furnitureId)
                        }

                    }
                });
            });

            //----------------------------------------------------------------------------------------------------
            //物品
            // db.sqlBatch([
            //     'CREATE TABLE IF NOT EXISTS thing (thingId integer primary key, name text, description text, image text, category text, owner text, planargraphId integer, spaceId integer, furnitureId text, number integer, layer integer, out integer)',
            //     ['INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/1.jpg', 1, 0, 'YmVuMzIzODhAZ21haWwuY29t1564997401544']],
            //     ['INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/2.jpg', 2, 1, 'YmVuMzIzODhAZ21haWwuY29t1564997401544']],
            //     ['INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/3.jpg', 3, 0, 'YmVuMzIzODhAZ21haWwuY29t1564997401544']],
            // ], function () {
            //     alert("sqlbatch");
            // }, function (error) {
            //     alert(error);
            // });
        }

        // 點選儲物櫃後跳出來的物品，夾層依照櫃子定義的層數跑回圈where去抓裡面有的東西

        function shrink(x) {

            $("#" + x + "").slideToggle();
            // alert(x);
        }

        function fidclick(x) {
            // 新增物品
            // alert(x)
            //atd 為增加物品的互動視窗
            var atd = `<div class="modal" id="atd` + x + `" tabindex="-1" role="dialog" aria-labelledby="atd` + x + `" aria-hidden="true">
                        <div class="modal-dialog modal-xl" role="document" style="margin: 0px;position: absolute;bottom:0px; max-width: 1500px;width:100vw;">
                            <div class="modal-content">
                                <div class="modal-body " style="background-color: rgb(255, 255, 255);padding: 5px 0px 16px 0px;">
                                    <div class="row objcenter">
                                        <p style="margin:0px ;">新增物品從</p>
                                    </div>
                                    <hr style="margin: 5px 0px 16px 0px">
                                    <div class="row objcenter">
                                        <a href="T01_insert.html?furniture=`+ x + `">單筆建立</a>
                                    </div>
                                    <hr>
                                    <div class="row objcenter">
                                        <a href="javascript:;" onclick="imgbatch('`+ x + `')">多筆建立</a>
                                    </div>
                                    <hr>
                                    <div class="row objcenter">
                                        <a href="javascript:;" onclick="tcancel('`+ x + `')">取消</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>`
            $("body").append(atd);
            $(".addthings").html("")

            //右下角功能鍵
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM furniture WHERE furnitureId = ?', [x],
                    function (tx, res) {
                        var addthing = `<nav class="cd-stretchy-nav">
                            <div></div>
                            <a class="cd-nav-trigger" href="#0">        
                            <span aria-hidden="true"></span>
                            </a>
                            <ul>
                                <li><a href="#0" onclick="thingaddclick( '`+ res.rows.item(0)['furnitureId'] + `' )"><span>新增物品 <i class="icon ion-md-add" style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 20px"></i></span></a></li>
                                <li><a href="#0" onclick="fnclick('` + res.rows.item(0)['furnitureId'] + `','` + res.rows.item(0)['name'] + `')"><span>修改儲物櫃名稱<i class="icon ion-md-create" style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 20px"></i></span></a></li>
                                <li><a href="#0" onclick="fpclick('` + res.rows.item(0)['furnitureId'] + `','` + res.rows.item(0)['image'] + `','` + res.rows.item(0)['name'] + `')"><span>修改儲物櫃圖片<i class="icon ion-ios-create" style="font-size:35px;color:rgb(255, 255, 255);padding:0 14px 0 19px"></i></span></a></li>
                                <li><a href="#0" onclick="fdclick('`+ res.rows.item(0)['furnitureId'] + `')"><span>刪除儲物櫃<i class="icon ion-ios-trash" style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 25px"></i></span></a></li>
                                <li><a href="#0" onclick="fsclick( '`+ res.rows.item(0)['furnitureId'] + `' )"><span>共享儲物櫃<i class="icon ion-ios-share" style="font-size:35px;color:rgb(255, 255, 255);padding:0 20px 0 25px"></i></span></a></li>
                            </ul> 
                            <span aria-hidden="true" class="stretchy-nav-bg"></span>
                            </nav>`;
                        $(".addthings").append(addthing);

                        if ($('.cd-stretchy-nav').length > 0) {
                            var stretchyNavs = $('.cd-stretchy-nav');

                            stretchyNavs.each(function () {
                                var stretchyNav = $(this),
                                    stretchyNavTrigger = stretchyNav.find('.cd-nav-trigger');

                                stretchyNavTrigger.on('click', function (event) {
                                    event.preventDefault();
                                    stretchyNav.toggleClass('nav-is-visible');
                                });
                            });

                            $(document).on('click', function (event) {
                                (!$(event.target).is('.cd-nav-trigger') && !$(event.target).is('.cd-nav-trigger span')) && stretchyNavs.removeClass('nav-is-visible');
                            });
                        }
                    });
            });

            //呈現物品
            db.transaction(function (tx) {
                $(".box-wrap").html("")
                tx.executeSql('SELECT DISTINCT layer FROM thing WHERE furnitureId = ? ORDER BY layer DESC', [x], function (tx, res) {
                    var len = res.rows.length;

                    if (res.rows.length >= 1) {
                        for (var i = 0; i < len; i++) {
                            var num = res.rows.item(i)['layer'];
                            // alert(num)
                            if (!num) {
                                var tr = function (num, i) {
                                    tx.executeSql('SELECT * FROM thing WHERE layer IS NULL AND furnitureId = ?', [x], function (tx, res) {
                                        $(".box-wrap").append(`<p onclick='shrink("shrink` + x + i + `")'>尚未編輯完成<i class='icon ion-md-arrow-dropdown'></i></p>`)
                                        var len = res.rows.length;
                                        // alert("num:" + num)
                                        // alert("WHERE layer Null len:" + len);
                                        // alert("res.rows.item(0)['image']:" + res.rows.item(0)["image"]);
                                        // alert("res.rows.item(0)['layer']" + res.rows.item(0)["layer"]);
                                        if (res.rows.length >= 1) {
                                            var warn
                                            $(".box-wrap").append('<div class="shrink" id ="shrink' + x + i + '"></div>')
                                            for (var j = 0; j < len; j++) {
                                                if (res.rows.item(j)['out'] == 1) {
                                                    warn = "<i class='icon ion-md-information-circle iwarn'></i>";
                                                } else {
                                                    warn = "";
                                                }
                                                $("#shrink" + x + i + "").append(`<div class="box">
                                                                `+ warn + `
                                                                <a href="T01_edit.html?thing=`+ res.rows.item(j)['thingId'] + `"><img src="` + res.rows.item(j)['image'] + `" style=width:100%;height:100%></a>
                                                                </div>`)
                                            }
                                            $("#shrink" + x + i + "").slideUp(0);
                                        }
                                    });
                                }(num, i)
                            } else if (num == "無夾層") {
                                var tr = function (num, i) {
                                    tx.executeSql('SELECT * FROM thing WHERE layer = ? AND furnitureId = ?', [num, x], function (tx, res) {
                                        var len = res.rows.length;
                                        // alert("num:" + num)
                                        // alert("WHERE layer len:" + len);
                                        // alert("res.rows.item(0)['thingId']:" + res.rows.item(0)["thingId"]);
                                        // alert("res.rows.item(0)['layer']" + res.rows.item(0)["layer"]);
                                        if (res.rows.length >= 1) {
                                            var warn
                                            $(".box-wrap").append('<div class="shrink" id ="shrink' + x + i + '"></div>')
                                            for (var j = 0; j < len; j++) {
                                                if (res.rows.item(j)['out'] == 1) {
                                                    warn = "<i class='icon ion-md-information-circle iwarn'></i>";
                                                } else {
                                                    warn = "";
                                                }
                                                $("#shrink" + x + i + "").append(`<div class="box">
                                                                `+ warn + `
                                                                <a href="T01_edit.html?thing=`+ res.rows.item(j)['thingId'] + `"><img src="` + res.rows.item(j)['image'] + `" style=width:100%;height:100%></a>
                                                                </div>`)
                                            }
                                        }
                                    });
                                }(num, i)
                            } else {
                                var tr = function (num, i) {
                                    tx.executeSql('SELECT * FROM thing WHERE layer = ? AND furnitureId = ?', [num, x], function (tx, res) {
                                        $(".box-wrap").append(`<p onclick='shrink("shrink` + x + i + `")'>第` + num + `層<i class='icon ion-md-arrow-dropdown'></i></p>`)
                                        var len = res.rows.length;
                                        // alert("num:" + num)
                                        // alert("WHERE layer len:" + len);
                                        // alert("res.rows.item(0)['thingId']:" + res.rows.item(0)["thingId"]);
                                        // alert("res.rows.item(0)['layer']" + res.rows.item(0)["layer"]);
                                        if (res.rows.length >= 1) {
                                            var warn
                                            $(".box-wrap").append('<div class="shrink" id ="shrink' + x + i + '"></div>')
                                            for (var j = 0; j < len; j++) {
                                                if (res.rows.item(j)['out'] == 1) {
                                                    warn = "<i class='icon ion-md-information-circle iwarn'></i>";
                                                } else {
                                                    warn = "";
                                                }
                                                $("#shrink" + x + i + "").append(`<div class="box">
                                                                `+ warn + `
                                                                <a href="T01_edit.html?thing=`+ res.rows.item(j)['thingId'] + `"><img src="` + res.rows.item(j)['image'] + `" style=width:100%;height:100%></a>
                                                                </div>`)
                                            }
                                            $("#shrink" + x + i + "").slideUp(0);
                                        }
                                    });
                                }(num, i)
                            }
                        }
                    } else {
                        // $(".box-wrap").append(`<div class="objcenter" style="height: 50vh;width: 100vw;">
                        //                     <p style="color:gray; font-size:18px;">請點選下方的加鍵，以新增物品。</p>
                        //                         </div>`)
                    }
                });
            });
        }

        // 長按觸發https://github.com/john-doherty/long-press-event

        // for (var i = 1; i < 5; i++) {
        //     var fpress = "fpress" + i
        //     var el = document.getElementById(fpress);
        //     el.addEventListener('long-press', function (e) {
        //         $('#exampleModal2').modal('show')

        //     });
        // };

        // 按鈕點選變色，點另一个按紐顏色還原
        var t = null;
        function fclick(x) {
            // 這個是判斷第一次點選
            document.getElementById(x).style.height = "110px";
            document.getElementById(x).style.width = "110px";
            document.getElementById(x).style.border = "3px solid yellow";
            //螢幕寬度
            var w = $(document).width()
            //點選的位置
            var set = $("#" + x + "").offset();
            //螢幕上左邊第一個的位置
            var first = $(".flex").scrollLeft()

            if (set.left > w) {
                $(".flex").animate({ scrollLeft: set.left }, 0);
            } else if (set.left > w * 0.75) {
                $(".flex").animate({ scrollLeft: first + w * 0.65 }, 300);
            } else if (set.left < 0) {
                $(".flex").animate({ scrollLeft: first - w * 0.65 }, 300);
            }

            if (t != null & x != t) {
                document.getElementById(t).style.height = "90px";
                document.getElementById(t).style.width = "90px";
                document.getElementById(t).style.border = "0px ";
            }
            t = x;
        };

        function thingaddclick(id) {
            $('#atd' + id + '').modal('show');
        }


        // 新增物品的取消
        function tcancel(id) {
            $('#atd' + id + '').modal('hide');
        }

        //fnclick fned 為儲物櫃名稱編輯修改互動視窗
        function fnclick(id, name) {
            $('#fed' + id).modal('hide')
            fned = `<div class="modal fade " id="fned` + id + `" tabindex="-1" role="dialog" aria-labelledby="fned` + id + `" aria-hidden="False">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content" style="margin-top: 50%;border-radius: 5%;">
                                            <div class="modal-body text-black">
                                                <form id='fnform'>
                                                    <div style="margin-bottom:10px;">
                                                        <label for="furniturename">儲物櫃名稱</label>
                                                        <P id="fndwarn" style="display:inline-flex;color: red;margin:0px;"></P>
                                                        <input type="text" class="form-control" id="furniturename`+ id + `" value="` + name + `" required>
                                        </div>
                                                        <div class="row" style="text-align: center">
                                                            <div class="col">
                                                                <button type="button" class="btn btn-outline-secondary" onclick="fndc('`+ id + `')">取消</button>
                                                            </div>
                                                            <div class="col">
                                                                <button type="button" class="btn btn-outline-secondary" onclick="fndv('`+ id + `')">確認</button>
                                                            </div>
                                                        </div>
                                    </form>
                                </div>
                                            </div>
                                        </div>
                                    </div>`
            $("body").append(fned);
            $('#fned' + id + '').modal('show')
        }

        // fndc 為儲物櫃名稱編輯修改互動視窗的取消鍵
        function fndc(id) {
            $("#fned" + id + "").modal('hide')
        }
        // fndv 為儲物櫃名稱編輯修改互動視窗的確認鍵,更新資料庫
        function fndv(id) {
            var name = $("#furniturename" + id + "").val();
            if (!name) {
                $('#fndwarn').html('<i class="icon ion-md-information-circle"></i>');
                $('#fndwarn').append("請輸入儲物櫃名稱");
                $('#fnform').addClass("was-validated");
                return
            }
            db.transaction(function (tx) {
                var query = "UPDATE furniture SET name = ? WHERE furnitureId = ?";
                tx.executeSql(query, [name, id], function (tx, res) {
                    fidclick(id);
                    fclick(id);
                    $("#fpoint" + id + "").text(name);
                    $("#fname" + id + "").text(name);
                    $("#fpname" + id + "").text(name);
                    $("#fdname" + id + "").text(name);
                    $("#fsname" + id + "").text(name);
                    $("#fned" + id + "").modal('hide');

                });
            });

        }

        //fdclick fdd 為儲物櫃刪除互動視窗
        function fdclick(id) {
            $('#fed' + id).modal('hide')
            $('#fdd' + id + '').modal('show')

        }

        function fddc(id) {
            $("#fdd" + id + "").modal('hide')
        }

        function fddv(id) {
            db.transaction(function (tx) {
                var query = "DELETE FROM furniture where furnitureId = ?";
                tx.executeSql(query, [id]);
                var query2 = "DELETE FROM thing where furnitureId = ?";
                tx.executeSql(query2, [id], function (tx, res) {
                    let urlParams = new URLSearchParams(window.location.search);
                    var spaceId = urlParams.get('space');
                    location.href = "F01.html?space=" + spaceId
                });
            });
            $("#fdd" + id + "").modal('hide')

        }

        //fpclick fped 為儲物櫃編輯照片互動視窗
        function fpclick(id, image, name) {
            $('#fed' + id).modal('hide')
            $('#fped' + id + '').modal('show')
        }

        // fpdv 為儲物櫃圖片編輯互動視窗的儲存鍵,更新資料庫
        function fpdv(id) {
            var img = document.getElementById("fimagedit" + id + "").src;

            db.transaction(function (tx) {
                var query = "UPDATE furniture SET image = ? WHERE furnitureId = ?";
                tx.executeSql(query, [img, id], function (tx, res) {
                    fidclick(id);
                    fclick(id);
                    var obj = document.getElementById("" + id + "");
                    obj.src = img;
                    $("#fped" + id + "").modal('hide');

                });
            });

        }

        function fpdc(id) {
            $("#fped" + id + "").modal('hide')
        }

        //fpclick fsd 為儲物櫃共享互動視窗
        function fsclick(id) {
            $('#fed' + id).modal('hide')
            $('#fsd' + id + '').modal('show')
        }

        function fsdc(id) {
            $("#fsd" + id + "").modal('hide')
        }

        function insertfurniture() {
            var name = $("#insertfname").val();
            if (!name) {
                $('#fnwarn').html('<i class="icon ion-md-information-circle"></i>');
                $('#fnwarn').append("請輸入儲物櫃名稱");
                $('#fform').addClass("was-validated");
                return
            }
            var a = $('#insertfphoto').hasClass('a');
            if (a === true) {
                $('#fpwarn').html('<i class="icon ion-md-information-circle"></i>');
                $('#fpwarn').append("請選擇儲物櫃照片");
                return
            }
            var img = document.getElementById("insertfphoto").src;
            //測試
            let urlParams = new URLSearchParams(window.location.search);
            var spaceId = urlParams.get('space');
            alert(spaceId);

            db.transaction(function (tx) {
                var timestamp = (new Date()).valueOf();
                // alert("timestamp"+timestamp);
                var furnitureId = btoa('ben32388@gmail.com') + timestamp;
                // alert("furnitureId"+furnitureId);

                tx.executeSql('INSERT INTO furniture (furnitureId, name, image, spaceId) VALUES (?,?,?,?)', [furnitureId, name, img, spaceId],
                    function (tx, res) {
                        location.href = "F01.html?space=" + spaceId + "&furniture=" + furnitureId + "";
                    }, function (error) {
                        alert('Something went Wrong');
                    });
                // tx.executeSql('INSERT INTO thing (image, furnitureId) VALUES (?,?)', ['static/things/4.jpg', furnitureId]);
                // tx.executeSql('INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/1.jpg', 2, 1, furnitureId]);
                // tx.executeSql('INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/3.jpg', 4, 0, furnitureId]);
                // tx.executeSql('INSERT INTO thing (image, layer, out, furnitureId) VALUES (?,?,?,?)', ['static/things/2.jpg', 3, 1, furnitureId]);
            });

        }

        // ----------------------------照相---------------------------------------
        function takephoto() {
            let opts = {
                quality: 100,
                destinationType: Camera.DestinationType.FILE_URI,
                sourceType: Camera.PictureSourceType.CAMERA,
                mediaType: Camera.MediaType.PICTURE,
                encodingType: Camera.EncodingType.JPEG,
                cameraDirection: Camera.Direction.BACK
            };
            navigator.camera.getPicture(function cameraSuccess(imgURI) {
                alert("data:" + imgURI);
                myimg = `<img src="` + imgURI + `" class="fphotothumb" id="insertfphoto">`;
                $("#fimg").text("");
                $("#fimg").append(myimg);
                // $('#exampleModal').modal('show')

            }, function cameraError(error) {
                alert("Unable to obtain picture: " + error, "app");
            }, opts);
        }


    </script>
    <script>
        function imgget() {
            var permissions = cordova.plugins.permissions;
            permissions.requestPermission(permissions.WRITE_EXTERNAL_STORAGE, function (s) {
                window.imagePicker.getPictures(
                    function (results) {
                        var imgURI = results[0]
                        alert(imgURI);
                        if (!imgURI) {
                        } else {
                            var myimg = `<img src="` + imgURI + `" class="fphotothumb" id="insertfphoto">`;
                            $("#fimg").text("");
                            $("#fimg").append(myimg);
                        }
                    }, function (error) {
                        console.log('Error: ' + error);
                    }, {
                        maximumImagesCount: 1,
                        quality: 50
                    }
                );
            }, function (error) {
                console.log('Error: ' + error);
            });

            // ImagePicker.getPictures(function (result) {
            //     alert(JSON.stringify(result));
            //     alert(result['images'][0]['uri']);
            //     var imgURI = result['images'][0]['uri']
            //     var myimg = `<img src="` + imgURI + `" class="fphotothumb" id="insertfphoto">`;
            //     $("#fimg").text("");
            //     $("#fimg").append(myimg);

            //     // $('#exampleModal').modal('show')
            // }, function (err) {
            //     alert(err);
            // }, {
            //         maximumImagesCount: 10,
            //         // width: 1920,
            //         // height: 1440,
            //         quality: 100
            //     });
        }

    </script>

    <script>
        function fimgedit(id) {

            window.imagePicker.getPictures(
                function (results) {
                    var imgURI = results[0]
                    if (!imgURI) {
                    } else {
                        var myimg = `<img src="` + imgURI + `" class="fephotothumb" id="fimagedit` + id + `">`;
                        $("#feimg" + id + "").text("");
                        $("#feimg" + id + "").append(myimg);
                    }
                }, function (error) {
                    console.log('Error: ' + error);
                }, {
                    maximumImagesCount: 1,
                    quality: 50
                }
            );

            // ImagePicker.getPictures(function (result) {
            //     alert(JSON.stringify(result));
            //     alert(result['images'][0]['uri']);
            //     var imgURI = result['images'][0]['uri']
            //     var myimg = `<img src="` + imgURI + `" class="fephotothumb" id="fimagedit` + id + `">`;
            //     $("#feimg" + id + "").text("");
            //     $("#feimg" + id + "").append(myimg);

            //     // $('#exampleModal').modal('show')
            // }, function (err) {
            //     alert(err);
            // }, {
            //         maximumImagesCount: 10,
            //         // width: 1920,
            //         // height: 1440,
            //         quality: 100
            //     });
        }

    </script>

    <script>
        function imgbatch(id) {

            var permissions = cordova.plugins.permissions;
            permissions.requestPermission(permissions.WRITE_EXTERNAL_STORAGE, function (s) {
                window.imagePicker.getPictures(
                    function (results) {
                        var len = results.length;
                        for (var i = 0; i < len; i++) {
                            var uri = results[i];
                            var timestamp = (new Date()).valueOf();
                            var thingId = btoa('ben32388@gmail.com') + timestamp + "" + i + "";
                            var tran = function (uri, thingId) {
                                db.transaction(function (tx) {
                                    tx.executeSql('INSERT INTO thing (thingId, image, furnitureId) VALUES (?,?,?)', [thingId, uri, id]);
                                });
                            }(uri, thingId);
                        }

                        fidclick(id);
                        fclick(id);
                        $("#atd" + id + "").modal('hide')
                    }, function (error) {
                        console.log('Error: ' + error);
                    }, {
                        maximumImagesCount: 10,
                        quality: 50
                    }
                );
            }, function (error) {
                console.log('Error: ' + error);
            });

            // ImagePicker.getPictures(function (result) {
            //     // alert(JSON.stringify(result));
            //     // alert(result['images'].length);
            //     var len = result['images'].length;
            //     for (var i = 0; i < len; i++) {
            //         var uri = result['images'][i]['uri'];
            //         var timestamp = (new Date()).valueOf();
            //         var thingId = btoa('ben32388@gmail.com') + timestamp + "" + i + "";
            //         var tran = function (uri, thingId) {
            //             db.transaction(function (tx) {
            //                 tx.executeSql('INSERT INTO thing (thingId, image, furnitureId) VALUES (?,?,?)', [thingId, uri, id]);
            //             });
            //         }(uri, thingId);
            //     }

            //     fidclick(id);
            //     fclick(id);
            //     $("#atd" + id + "").modal('hide')
            // }, function (err) {
            //     alert(err);
            // }, {
            //         maximumImagesCount: 10,
            //         quality: 100
            //     });
        }

    </script>

</body>

</html>