<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 匯入ionicons 字型圖標 -->
    <link type="text/css" rel="stylesheet" href="../www/css/mmenu.css" />
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <script src="js/jquery-3.4.1.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <link rel=stylesheet type="text/css" href="../www/css/H01.css">

    <!-- mmenu scripts -->
    <script src="../www/js/mmenu.js"></script>
    <script src="../www/js/mmenu.debugger.js"></script>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <title>H01</title>
</head>

<body>

    <div id="page" class="outer">

        <!-- 導覽列 -->
        <ul class="nav header fixed-top">
            <li class="nav-item two">
                <a class="nav-link active" href="#menu"></a>
            </li>
            <li class="dropdown nav-fill">
                <a id="pnid" class="nav-item dropdown-toggle" data-toggle="dropdown" href="#" role="button"
                    aria-haspopup="true" aria-expanded="false"></a>
                <div class="dropdown-menu  plan1">
                    <!-- <a class="dropdown-item plan1"></a> -->
                    <!-- <a class="dropdown-item">二樓</a>
                    <a class="dropdown-item">三樓</a> -->
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item " data-toggle="modal" data-target="#exampleModalCenter3">新增</a>
                    <a class="dropdown-item " data-toggle="modal" data-target="#exampleModalCenter4" id="pedit"
                        style="display:none;">編輯</a>
                    <a class="dropdown-item " data-toggle="modal" data-target="#exampleModalCenter5" id="pdelete"
                        style="display:none;">刪除</a>
                </div>
            </li>

        </ul>
        <nav id="menu">
            <ul>
                <li><a href="../www/H02.html">與我共用的項目</a></li>
                <li><a href="../www/H03.html">儲存的文章</a></li>
                <li><a href="../www/H04.html">物品提醒</a></li>
                <li><a href="#">同步</a></li>
                <li><a href="#" onclick="reset()">重設密碼</a></li>
                <li><a href="#" onclick="logout()">登出</a></li>
            </ul>
        </nav>
    </div>
    <!-- 因mmenu的關係代替margin-top:30px; -->
    <div style="height: 30px;"></div>
    <!-- 顯示格局的地方 -->
    <div class="box-wrap">

    </div>
    <!-- 新增樓層的彈跳視窗 -->

    <div class="modal fade hide bd-example-modal-sm" id="exampleModalCenter3" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">新增樓層</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body ">
                    <form id='pniform'>
                        <label for="exampleInputPassword1">名稱</label>
                        <P id="pniwarn" style="display:inline-flex;color: red;margin:0px;"></P>
                        <input id="insertpname" class="form-control" placeholder="" required>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" onclick="insertplanargraph()">確認</button>
                </div>
            </div>

        </div>
    </div>

    <!-- 是否繼續新增樓層互動視窗 -->
    <div class="modal hide fade" id="addpwarn" tabindex="-1" role="dialog" aria-labelledby="addpwarn"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-radius: 5%;">
                <div class="modal-body text-black">
                    <p style="font-size: 16px"><span id="existedp" style="font-size: 20px"></span>
                        已經存在，可能會造成混淆，是否繼續以相同名稱創建?</p>
                    <div class="row" style="text-align: center">
                        <div class="col">
                            <button type="button" class="btn btn-outline-secondary" onclick="addpwarnNo()">否</button>
                        </div>
                        <div class="col">
                            <button type="submit" class="btn btn-outline-secondary" onclick="addpwarnYes()">是</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 編輯樓層的彈跳視窗 -->

    <div class="modal fade bd-example-modal-sm" id="exampleModalCenter4" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">編輯樓層</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body ">
                    <form id='pneform'>
                        <label for="exampleInputPassword1">名稱</label>
                        <P id="pnewarn" style="display:inline-flex;color: red;margin:0px;"></P>
                        <input id="editpname" class="form-control" placeholder="" required>
                    </form>
                </div>
                <div class="modal-footer">
                    <!-- <button id="delname" type="button" class="btn"> <i class="ion-md-trash icon3"></i></button> -->
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button id="editPlanargraph" type="button" class="btn btn-primary">確認</button>
                </div>
            </div>

        </div>
    </div>

    <!-- 刪除平面圖 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="exampleModalCenter5" aria-labelledby="exampleModalLabel5"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="margin-top: 50%;border-radius: 5%;">
                <div class="modal-body text-black">
                    <p style="font-size: 16px">是否要刪除<span id="delPname"></span>?</p>
                    <div class="row" style="text-align: center">
                        <div class="col">
                            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">取消</button>
                        </div>
                        <div class="col">
                            <button id="delPlanargraph" type="button" class="btn btn-outline-secondary">確認</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 新增格局的彈跳按鈕 -->
    <div class="circlefix add" data-toggle="modal" data-target="#exampleModalCenter2" id="saddbutton"
        style="display:none;">
        <i class="icon ion-md-add"></i>
    </div>
    <!-- 新增格局的彈跳視窗 -->

    <div class="modal fade bd-example-modal-sm" id="exampleModalCenter2" tabindex="-1" role="dialog"
        aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">新增格局</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body ">
                    <form id='sniform'>
                        <label for="insertsname">名稱</label>
                        <P id="sniwarn" style="display:inline-flex;color: red;margin:0px;"></P>
                        <input id="insertsname" class="form-control" placeholder="" required>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button id="insertspace" type="button" class="btn btn-primary">確認</button>
                </div>
            </div>

        </div>
    </div>


    <!-- 修改格局的彈跳視窗-->
    <div class="modal" id="editSpace" tabindex="-1" role="dialog" aria-labelledby="editSpace" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document"
            style="margin: 0px;position: absolute;bottom:0px; max-width: 1500px;width:100vw">
            <div class="modal-content" style="border-radius: 0%;">
                <div class="modal-body " style="background-color: #254F6E">
                    <div class="row" style="width:100vw;text-align: center">
                        <div class="col-4 icon22">
                            <button onclick="closespace()" class="buttontype" data-toggle="modal"
                                data-target="#editsmodal">
                                <i class="ion-md-create icon2"></i>
                                <p>編輯</p>
                            </button>
                        </div>
                        <div class="col-4 icon22 ">
                            <button onclick="closespace()" class="buttontype" data-toggle="modal"
                                data-target="#delsmodal">
                                <i class=" ion-md-trash icon2"></i>
                                <p>刪除</p>
                            </button>
                        </div>
                        <div class="col-4 icon22">
                            <button id="editscolor" onclick="closespace()" class="buttontype" data-toggle="modal"
                                data-target="#colormodal">
                                <i class=" ion-md-list icon2"></i>
                                <p>顏色</p>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 編輯格局名稱的彈跳視窗 -->

    <div class="modal fade bd-example-modal-sm" id="editsmodal" tabindex="-1" role="dialog" aria-labelledby="editsmodal"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">編輯格局</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body ">
                    <form id='sneform'>
                        <label for="exampleInputPassword1">名稱</label>
                        <P id="snewarn" style="display:inline-flex;color: red;margin:0px;"></P>
                        <input id="editsnameval" class="form-control" placeholder="" required>
                    </form>
                </div>
                <div class="modal-footer">
                    <!-- <button id="delname" type="button" class="btn"> <i class="ion-md-trash icon3"></i></button> -->
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button id="editsname" type="button" class="btn btn-primary">確認</button>
                </div>
            </div>

        </div>
    </div>

    <!-- 刪除格局 -->
    <div class="modal fade" tabindex="-1" role="dialog" id="delsmodal" aria-labelledby="delsmodal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="margin-top: 50%;border-radius: 5%;">
                <div class="modal-body text-black">
                    <p style="font-size: 16px">是否要刪除<span id="delsname"></span>?</p>
                    <div class="row" style="text-align: center">
                        <div class="col">
                            <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">取消</button>
                        </div>
                        <div class="col">
                            <button id="delspace" type="button" class="btn btn-outline-secondary">確認</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- 重設密碼互動視窗 -->
    <div class="modal fade " id="resetpassword" tabindex="-1" role="dialog" aria-labelledby="resetpassword"
        aria-hidden="False">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content" style="border-radius: 5%;">
                <div class="modal-header">
                    <h5 class="modal-title">重設密碼</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body text-black" id="resettext">

                </div>
            </div>
        </div>
    </div>

    <div class="modal fade bd-example-modal-sm" id="colormodal" tabindex="-1" role="dialog" aria-labelledby="editsmodal"
        aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalCenterTitle">選擇顏色</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body ">
                    <form>
                        <label>顏色</label>
                        <input type="color" id="colorid">
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">取消</button>
                    <button id="editcolor" type="button" class="btn btn-primary">確認</button>
                </div>
            </div>

        </div>
    </div>



    <div class="container-fluid  footer">
        <div class="row row1 ">
            <div class="col-4 icon">
                <a href="S01.html">
                    <i class="icon ion-md-search icon1"></i>

                </a>
            </div>
            <div class="col-4 icon ">
                <a href="H01.html">
                    <i class="icon ion-md-home icon1" style="color: #254F6E"></i>

                </a>
            </div>
            <div class="col-4 icon">
                <a href="A01.html">
                    <i class="icon ion-md-bookmarks icon1"></i>

                </a>
            </div>

        </div>

    </div>


    <script>
        var user_email;
        var user_token;


        new Mmenu(document.querySelector('#menu'));

        document.addEventListener('click', (evnt) => {
            let anchor = evnt.target.closest('a[href^="#/"]');
            if (anchor) {
                alert('Thank you for clicking, but that\'s a demo link.');
                evnt.preventDefault();
            }
        });

        document.addEventListener("deviceready", onDeviceReady, false);
        var db;
        function onDeviceReady() {
            db = window.sqlitePlugin.openDatabase({
                name: 'my.db',
                location: 'default',
            });
            //提醒跳轉
            cordova.plugins.notification.local.on("click", function (notification) {
                window.location.href = 'T01_edit.html?thing=' + notification.thingId + ''
            });

            db.transaction(function (tx) {
                tx.executeSql('CREATE TABLE IF NOT EXISTS user (email text primary key, token text, nickname text, home integer, furniture_page integer, thing_page integer, search_page integer, post_page integer)');
                tx.executeSql('CREATE TABLE IF NOT EXISTS planargraph(planargraphId text primary key, name text, email text)');
                tx.executeSql('CREATE TABLE IF NOT EXISTS space (spaceId text primary key, name text, space_color text, planargraphId text)');
            });


            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM user', [],
                    function (tx, res) {
                        var len = res.rows.length;
                        if (res.rows.length >= 1) {
                            user_email = res.rows.item(0)['email']
                            user_token = res.rows.item(0)['token']
                            $(".mm-navbar__title").html("Hi~"+" "+res.rows.item(0)['nickname']);
                            tx.executeSql('SELECT * FROM planargraph WHERE email = ?', [res.rows.item(0)['email']], function (tx, res) {
                                var len = res.rows.length;

                                if (res.rows.length >= 1) {
                                    for (var i = 0; i < len; i++) {
                                        $(".plan1").prepend(`<a class="dropdown-item" onclick="pnidclick('` + res.rows.item(i)['planargraphId'] + `')">` + res.rows.item(i)['name'] + `</a>`)
                                    }
                                    $("#pedit").css('display', 'block');
                                    $("#pdelete").css('display', 'block');
                                    $("#saddbutton").css('display', 'block');
                                    let urlParams = new URLSearchParams(window.location.search);
                                    // alert(urlParams)
                                    var planargraphId = urlParams.get('planargraph');
                                    if (!planargraphId) {
                                        pnidclick(res.rows.item(0)['planargraphId'])

                                    } else {
                                        pnidclick(planargraphId)

                                    }
                                }
                            });

                        }
                    });
            });
        }



        // 更改點擊選單中的平面圖
        // pnid為標題顯示文字
        // editpname 為編輯輸入框
        //editPlanargraph 為編輯平面圖名稱的確認鍵
        //delPlanargraph  為編刪除平面圖的確認鍵
        //insertspace 新增格局
        function pnidclick(id) {
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM planargraph WHERE planargraphId = ?', [id],
                    function (tx, res) {
                        $("#pnid").html(res.rows.item(0)['name'])
                        $("#editpname").val(res.rows.item(0)['name'])
                        $("#delPname").html(res.rows.item(0)['name'])
                    });
            });
            $('#insertspace').attr('onclick', 'insertspace("' + id + '")');
            $('#editPlanargraph').attr('onclick', 'editplanargraph("' + id + '")');
            $('#delPlanargraph').attr('onclick', 'delPlanargraph("' + id + '")');

            //呈現格局
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM space WHERE planargraphId = ?', [id],
                    function (tx, res) {
                        $(".box-wrap").html("")
                        var len = res.rows.length;
                        if (res.rows.length >= 1) {
                            for (var i = 0; i < len; i++) {
                                $(".box-wrap").append(`<div style="background-color:` + res.rows.item(i)['space_color'] + `;" class="box">
                                                        <i id="spacemore" onclick='spacemore("`+ res.rows.item(i)['spaceId'] + `")' class='icon ion-md-more imore'></i>
                                                        <a href="F01.html?space=`+ res.rows.item(i)['spaceId'] + `"><span id="sname` + res.rows.item(i)['spaceId'] + `" style="color: white;text-shadow: 0 0 0.2em rgba(32, 31, 31, 0.568);">` + res.rows.item(i)['name'] + `</span></a>
                                                        </div>`)
                            }
                        }
                    });
            });

        }
        //關閉修改格局(編輯 刪除 顏色)互動視窗
        function closespace() {
            $("#editSpace").modal('hide');
        }
        //點選格局三個點點
        function spacemore(spaceId) {
            $("#editSpace").modal('show');
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM space WHERE spaceId = ?', [spaceId],
                    function (tx, res) {
                        $("#editsnameval").val(res.rows.item(0)['name'])
                        $("#delsname").html(res.rows.item(0)['name'])
                        if (!res.rows.item(0)['space_color']) {
                            $("#colorid").val("#047e7e")
                        } else {
                            $("#colorid").val(res.rows.item(0)['space_color'])
                        }
                    });
            });
            $('#editsname').attr('onclick', 'editsname("' + spaceId + '")');
            $('#delspace').attr('onclick', 'delspace("' + spaceId + '")');
            $('#editcolor').attr('onclick', 'editcolor("' + spaceId + '")');

        }

        //修改顏色
        function editcolor(id) {
            var spacecolor = $("#colorid").val();
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM space WHERE spaceId = ?', [id],
                    function (tx, res) {
                        var planargraphId = res.rows.item(0)['planargraphId']
                        tx.executeSql("UPDATE space SET space_color = ? WHERE spaceId = ?", [spacecolor, id],
                            function (tx, res) {
                                location.href = "H01.html?planargraph=" + planargraphId + "";
                            });
                    });
            });
        }

        //修改格局
        function editsname(id) {
            var name = $("#editsnameval").val();
            if (!name) {
                $('#snewarn').html('<i class="icon ion-md-information-circle"></i>');
                $('#snewarn').append("請輸入格局名稱");
                $('#sneform').addClass("was-validated");
                return
            }
            db.transaction(function (tx) {
                var query = "UPDATE space SET name = ? WHERE spaceId = ?";
                tx.executeSql(query, [name, id], function (tx, res) {
                    $("#editsmodal").modal('hide');
                    $("#sname" + id + "").html(name);
                });
            });

        }


        //修改平面圖
        function editplanargraph(id) {
            var name = $("#editpname").val();
            if (!name) {
                $('#pnewarn').html('<i class="icon ion-md-information-circle"></i>');
                $('#pnewarn').append("請輸入樓層名稱");
                $('#pneform').addClass("was-validated");
                return
            }
            db.transaction(function (tx) {
                var query = "UPDATE planargraph SET name = ? WHERE planargraphId = ?";
                tx.executeSql(query, [name, id], function (tx, res) {
                    $("#exampleModalCenter4").modal('hide');
                    location.href = "H01.html?planargraph=" + id + "";
                });
            });

        }

        // 刪除格局
        function delspace(id) {

            var planargraphId
            db.transaction(function (tx) {
                tx.executeSql('SELECT * FROM space WHERE spaceId = ?', [id],
                    function (tx, res) {
                        planargraphId = res.rows.item(0)['planargraphId']

                        tx.executeSql("SELECT * FROM furniture WHERE spaceId = ?", [id], function (tx, res) {
                            var len = res.rows.length;
                            if (res.rows.length >= 1) {
                                for (var j = 0; j < len; j++) {
                                    var trans = function (j) {
                                        tx.executeSql("DELETE FROM thing WHERE furnitureId = ?", [res.rows.item(j)['furnitureId']]);
                                    }(j);
                                }
                                tx.executeSql("DELETE FROM furniture WHERE spaceId = ?", [id], function (tx, res) {
                                    tx.executeSql("DELETE FROM space WHERE spaceId = ?", [id], function (tx, res) {
                                        location.href = "H01.html?planargraph=" + planargraphId + "";
                                    });
                                });
                            } else {
                                tx.executeSql("DELETE FROM space WHERE spaceId = ?", [id], function (tx, res) {
                                    location.href = "H01.html?planargraph=" + planargraphId + "";
                                });
                            }
                        });
                    });
            });
        }


        // 刪除平面圖
        function delPlanargraph(id) {
            db.transaction(function (tx) {
                tx.executeSql("SELECT * FROM space WHERE planargraphId = ?", [id], function (tx, res) {
                    var len = res.rows.length;
                    if (res.rows.length >= 1) {
                        for (var i = 0; i < len; i++) {
                            var tran = function (i) {
                                var spaceId = res.rows.item(i)['spaceId']
                                tx.executeSql("SELECT * FROM furniture WHERE spaceId = ?", [spaceId], function (tx, res) {
                                    var len = res.rows.length;
                                    if (res.rows.length >= 1) {
                                        for (var j = 0; j < len; j++) {
                                            var trans = function (j) {
                                                tx.executeSql("DELETE FROM thing where furnitureId = ?", [res.rows.item(j)['furnitureId']]);
                                            }(j);
                                        }
                                        tx.executeSql("DELETE FROM furniture where spaceId = ?", [spaceId], function (tx, res) {
                                            tx.executeSql("DELETE FROM space WHERE planargraphId = ?", [id], function (tx, res) {
                                                tx.executeSql("DELETE FROM planargraph WHERE planargraphId = ?", [id], function (tx, res) {
                                                    location.href = "H01.html"
                                                });
                                            });
                                        });
                                    } else {
                                        tx.executeSql("DELETE FROM space WHERE planargraphId = ?", [id], function (tx, res) {
                                            tx.executeSql("DELETE FROM planargraph WHERE planargraphId = ?", [id], function (tx, res) {
                                                location.href = "H01.html"
                                            });
                                        });
                                    }
                                });

                            }(i);
                        }
                    } else {
                        tx.executeSql("DELETE FROM planargraph WHERE planargraphId = ?", [id], function (tx, res) {
                            location.href = "H01.html"
                        });
                    }
                });
            });
        }


        // 新增平面圖(預設一樓))
        //exampleModalCenter3 新增樓層的彈跳視窗
        //insertpname 新增樓層的輸入框
        //要抓到目前登入使用者的帳號
        function insertplanargraph() {
            db.transaction(function (tx) {
                var timestamp = (new Date()).valueOf();
                // alert("timestamp"+timestamp);
                var email = user_email.replace(/@/g, "").split(".").join("");
                var planargraphId = email + timestamp;
                var name = $("#insertpname").val();
                if (!name) {
                    $('#pniwarn').html('<i class="icon ion-md-information-circle"></i>');
                    $('#pniwarn').append("請輸入樓層名稱");
                    $('#pniform').addClass("was-validated");
                    return
                }
                tx.executeSql('SELECT * FROM planargraph WHERE email = ?', [user_email],
                    function (tx, res) {
                        var len = res.rows.length;
                        if (res.rows.length >= 1) {
                            for (var i = 0; i < len; i++) {
                                $('#exampleModalCenter3').modal('hide')
                                if (name == res.rows.item(i)['name']) {

                                    $("#existedp").html(name)
                                    $('#addpwarn').modal('show')
                                    return false;
                                }

                            }

                        }
                        tx.executeSql('INSERT INTO planargraph (planargraphId, name, email) VALUES (?,?,?)', [planargraphId, name, user_email],
                            function (tx, res) {
                                $('#exampleModalCenter3').modal('hide')
                                $("#insertpname").val("");
                                location.href = "H01.html?planargraph=" + planargraphId + "";
                            }, function (error) {
                                alert('Something went Wrong');
                            });
                    });


            });
        }
        // 是否繼續新增樓層互動視窗
        function addpwarnNo() {
            $('#addpwarn').modal('hide')
            $('#exampleModalCenter3').modal('show')
        }
        // 是否繼續新增樓層互動視窗
        function addpwarnYes() {
            $('#addpwarn').modal('hide')
            db.transaction(function (tx) {
                var timestamp = (new Date()).valueOf();
                var email = user_email.replace(/@/g, "").split(".").join("");
                var planargraphId = email + timestamp;
                var name = $("#insertpname").val();
                tx.executeSql('INSERT INTO planargraph (planargraphId, name, email) VALUES (?,?,?)', [planargraphId, name, user_email],
                    function (tx, res) {
                        $('#exampleModalCenter3').modal('hide')
                        $("#insertpname").val("");
                        location.href = "H01.html?planargraph=" + planargraphId + "";
                    }, function (error) {
                        alert('Something went Wrong');
                    });
            });

        }


        // 新增格局

        function insertspace(planargraphId) {

            db.transaction(function (tx) {
                var timestamp = (new Date()).valueOf();
                // alert("timestamp"+timestamp);
                var email = user_email.replace(/@/g, "").split(".").join("")
                var spaceId = email + timestamp;
                var name = $("#insertsname").val();
                if (!name) {
                    $('#sniwarn').html('<i class="icon ion-md-information-circle"></i>');
                    $('#sniwarn').append("請輸入格局名稱");
                    $('#sniform').addClass("was-validated");
                    return
                }

                tx.executeSql('INSERT INTO space (spaceId, name, planargraphId) VALUES (?,?,?)', [spaceId, name, planargraphId],
                    function (tx, res) {
                        $('#exampleModalCenter2').modal('hide')
                        $("#insertsname").val("");
                        location.href = "H01.html?planargraph=" + planargraphId + "";
                    }, function (error) {
                        alert('Something went Wrong');
                    });
            });
        }

        // 重設密碼
        function reset() {
            // $('#menu1').click();
            $("html").removeClass("mm-wrapper_opening")
            $.ajax({
                type: "POST",
                url: "http://140.131.114.157/users/password_reset",
                data: {
                    "email": user_email
                },
                error: function (err) {
                    alert(err)
                },
                success: function (res) {
                    $("#resettext").html(`<p style="font-size:18px;"><b>變更密碼確認信已送出</b></p>
                                 <p>為了確保會員切身的權益，我們已經寄發確認信到 <span style="font-size:18px;"> `+ user_email + `</span>。</p>
                                 <p>請在24小時內至該信箱收取確認信，並重新設定密碼。</p>`)
                    $("#resetpassword").modal("show")
                }
            })
        }

        function logout() {
            db.transaction(function (tx) {
                tx.executeSql('DROP TABLE IF EXISTS user', [], function (tx, res) {
                    location.href = 'index.html'
                });
            });
        }




    </script>

</body>

</html>